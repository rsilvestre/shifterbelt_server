{"version":3,"sources":["authentication.es6"],"names":[],"mappings":"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","file":"authentication.js","sourcesContent":["/**\n * Created by michaelsilvestre on 30/05/15\n */\n\nimport mongoose from \"mongoose\"\nimport getmac from \"getmac\"\nimport { logger } from \"../lib/logger.js\"\n\nimport _ from \"underscore\"\n\nlet Application = mongoose.model('Application');\n\nexport default class Authentication {\n  constructor(data) {\n    if (!data) {\n      return null;\n    }\n    this._data = JSON.parse(data);\n  }\n\n  checkAuthToken(callback) {\n\n    if (!this._data.hasOwnProperty('applicationId')) {\n      return callback(new Error(\"Missing applicationId for the authentification\"), null);\n    }\n\n    if (!this._data.hasOwnProperty('key')) {\n      return callback(new Error(\"Missing key for the authentification\"), null);\n    }\n\n    if (!this._data.hasOwnProperty('password')) {\n      return callback(new Error(\"Missing password for the authentification\"), null);\n    }\n\n    if (!this._data.hasOwnProperty('macAddress')) {\n      return callback(new Error(\"Missing macAddress for the authentification\"), null);\n    }\n\n    if (!_.isString(this._data['key'])) {\n      return callback(new Error(\"Key should be a string\"), null);\n    }\n\n    if (this._data['key'].length !== 40) {\n      return callback(new Error(\"Key has not the good size\"), null);\n    }\n\n    if (!_.isString(this._data['password'])) {\n      return callback(new Error(\"Password should be a string\"), null);\n    }\n\n    if (this._data['password'].length !== 80) {\n      return callback(new Error(\"Password has not the good size\"), null);\n    }\n\n    if (!_.isNumber(this._data['applicationId'])) {\n      return callback(new Error(\"ApplicationId should be a number\"), null);\n    }\n\n    if (!getmac.isMac(this._data['macAddress'])) {\n      return callback(new Error(\"The mac address is not correctly formated\"), null);\n    }\n\n    Application.authenticate(this._data, (err, result) => {\n      if (err) {\n        return callback(err, null);\n      }\n      if (!result) {\n        return callback(new Error(\"The applicationId are not correct\"), null);\n      }\n      if (null === result.device.role || result.device.role.length === 0 || result.device.role === \"\") {\n        return callback(new Error(\"The key and password are not correct\"), null);\n      }\n      logger.info(result);\n      return callback(null, result);\n    });\n  }\n}\n"]}